# リリース手順チェックリスト

このドキュメントでは、代謝計算機のリリース手順をチェックリスト形式で記載しています。
リリース前に必ずすべての項目を確認してください。

---

## 📋 リリース前チェックリスト

### 1. コード品質

- [ ] テストがすべて通る（`npm test`）
- [ ] リンターエラーがない（`npm run lint`）
- [ ] ビルドエラーがない（`npm run build`）
- [ ] TypeScript型エラーがない
- [ ] 未使用のコードやコメントがない
- [ ] セキュリティ脆弱性がない（`npm audit`）

### 2. ドキュメント更新

- [ ] `CHANGELOG.md` に変更内容を記載
- [ ] セマンティックバージョニングに従ったバージョン番号を設定
- [ ] `README.md` の機能説明が最新である
- [ ] 新しい機能や変更点がドキュメントに反映されている
- [ ] ADRが必要な場合は `docs/adr/` に記録

### 3. 環境変数・設定

- [ ] `.env.example` が最新である
- [ ] 新しい環境変数が `.env.example` に追加されている
- [ ] Vercelの環境変数が正しく設定されている（本番環境）
- [ ] Upstash Redisの設定が正しい（レート制限使用時）
- [ ] Sentryの設定が正しい（エラー監視使用時）

### 4. パフォーマンス確認

- [ ] ビルドサイズが適切である（`npm run build:analyze` で確認）
- [ ] ページの読み込み速度が適切である
- [ ] APIレスポンス時間が適切である
- [ ] 画像最適化が正しく動作している

### 5. セキュリティ確認

- [ ] 機密情報（APIキー、トークン）がコードに含まれていない
- [ ] `.env.local` や `.env` が `.gitignore` に含まれている
- [ ] セキュリティヘッダーが正しく設定されている（`next.config.js`）
- [ ] 依存パッケージの脆弱性がない（`npm audit fix`）

### 6. 動作確認

- [ ] ローカル環境で正常に動作する（`npm run dev`）
- [ ] 本番ビルドが正常に動作する（`npm run build && npm start`）
- [ ] すべての主要機能が動作する
  - [ ] BMR計算
  - [ ] TDEE計算
  - [ ] 目標カロリー計算
  - [ ] マクロ栄養素計算
  - [ ] エクスポート機能（PNG、PDF、JSON、CSV）
  - [ ] URL共有機能
  - [ ] LocalStorage保存機能
- [ ] レスポンシブデザインが正しく動作する（モバイル・タブレット・デスクトップ）
- [ ] ブラウザ互換性（Chrome、Firefox、Safari、Edge）

### 7. エラーハンドリング

- [ ] バリデーションエラーが適切に表示される
- [ ] ネットワークエラーが適切に処理される
- [ ] 計算エラーが適切に処理される
- [ ] エラーログが正しく記録される（Sentry使用時）

---

## 🚀 リリース手順

### ステップ1: ブランチの準備

```bash
# 最新のmainブランチを取得
git checkout main
git pull origin main

# リリース用ブランチを作成（オプション）
git checkout -b release/v0.X.X
```

### ステップ2: バージョン番号の更新

1. `CHANGELOG.md` を更新
   - 新しいバージョンセクションを追加
   - 変更内容を記載（Added、Changed、Fixed、Removedなど）

2. セマンティックバージョニングに従う
   - `MAJOR.MINOR.PATCH` 形式
   - `MAJOR`: 破壊的変更
   - `MINOR`: 後方互換性のある新機能
   - `PATCH`: バグ修正

### ステップ3: 最終確認

上記のチェックリストをすべて確認し、問題がないことを確認する。

### ステップ4: コミット・プッシュ

```bash
# 変更をコミット
git add .
git commit -m "chore: リリース v0.X.X準備"

# リモートにプッシュ
git push origin main  # または release/v0.X.X

# タグを作成（オプション）
git tag -a v0.X.X -m "リリース v0.X.X"
git push origin v0.X.X
```

### ステップ5: Vercelへのデプロイ

#### 自動デプロイ（GitHub連携時）

1. GitHubにプッシュすると自動的にデプロイが開始されます
2. Vercelダッシュボードでデプロイ状況を確認
3. デプロイ完了後、動作確認

#### 手動デプロイ（Vercel CLI使用時）

```bash
# Vercel CLIでデプロイ
vercel --prod
```

### ステップ6: デプロイ後の確認

- [ ] 本番環境で正常に動作する
- [ ] すべての主要機能が動作する
- [ ] エラー監視（Sentry）が正常に動作する（設定している場合）
- [ ] レート制限が正常に動作する（設定している場合）
- [ ] パフォーマンスが適切である

### ステップ7: リリースノートの作成（オプション）

GitHubのRelease機能を使用してリリースノートを作成：

1. GitHubリポジトリ → Releases → Draft a new release
2. タグを選択
3. `CHANGELOG.md` の内容をコピー
4. Publish release

---

## 📝 リリース後の確認

### 24時間以内

- [ ] エラーログを確認（Sentryダッシュボード）
- [ ] パフォーマンスメトリクスを確認
- [ ] ユーザーフィードバックがあれば確認

### 1週間以内

- [ ] 問題が報告されていないか確認
- [ ] パフォーマンスが低下していないか確認
- [ ] 次のリリースの計画を立てる

---

## 🔄 ホットフィックス手順

緊急のバグ修正が必要な場合：

1. `main` ブランチから直接修正ブランチを作成
2. 最小限の変更でバグを修正
3. テストを実行して修正を確認
4. `CHANGELOG.md` にホットフィックス内容を記載
5. プッシュしてデプロイ
6. 後でIssueを作成して記録

```bash
git checkout main
git pull origin main
git checkout -b hotfix/critical-bug-fix
# 修正を実施
git commit -m "fix: 緊急バグ修正 (#XXX)"
git push origin hotfix/critical-bug-fix
# PRを作成してマージ後、デプロイ
```

---

## 📚 関連ドキュメント

- [Vercelデプロイガイド](DEPLOY.md)
- [Upstash Redis セットアップガイド](UPSTASH_SETUP.md)
- [開発ルール](../development_rules.md)
- [CHANGELOG](../CHANGELOG.md)

---

## ⚠️ 注意事項

- **本番環境へのデプロイは慎重に行う**
- **重大な変更は事前にテスト環境で十分に検証する**
- **環境変数の変更はすべての環境（Production、Preview、Development）で確認する**
- **セキュリティ関連の変更は特に注意する**

