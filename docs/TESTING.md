# ãƒ†ã‚¹ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œæ–¹æ³•ã¨CI/CDã§ã®ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ“‹ ãƒ†ã‚¹ãƒˆã®ç¨®é¡

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ä»¥ä¸‹ã®4ç¨®é¡ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ï¼š

1. **ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ** (`tests/validation.test.ts`)
   - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã®ãƒ†ã‚¹ãƒˆ
   - Zodã‚¹ã‚­ãƒ¼ãƒã®æ¤œè¨¼

2. **çµ±åˆãƒ†ã‚¹ãƒˆ** (`tests/api/calculate.test.ts`)
   - API Routeã®ãƒ†ã‚¹ãƒˆ
   - ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å‹•ä½œç¢ºèª

3. **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ** (`components/CalculationForm.test.tsx`)
   - Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã®æ¤œè¨¼

4. **E2Eãƒ†ã‚¹ãƒˆ** (`tests/e2e/metabolism-calculator.spec.ts`)
   - Playwrightã‚’ä½¿ç”¨ã—ãŸãƒ–ãƒ©ã‚¦ã‚¶ãƒ™ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆ
   - å®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼ã®æ¤œè¨¼

## ğŸš€ ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

### ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ

```bash
npm test
```

### ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ

```bash
npm test
# ã¾ãŸã¯
npm test -- --watch
```

### UIãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ

```bash
npm run test:ui
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒ†ã‚¹ãƒˆçµæœã‚’è¦–è¦šçš„ã«ç¢ºèªã§ãã¾ã™ã€‚

### ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆ

```bash
npm run test:coverage
```

ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆãŒ `coverage/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç”Ÿæˆã•ã‚Œã¾ã™ã€‚

- **HTMLãƒ¬ãƒãƒ¼ãƒˆ**: `coverage/index.html` ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã
- **LCOVãƒ¬ãƒãƒ¼ãƒˆ**: `coverage/lcov.info`ï¼ˆCI/CDã§ä½¿ç”¨ï¼‰

## ğŸ”„ CI/CDã§ã®è‡ªå‹•ãƒ†ã‚¹ãƒˆ

### GitHub Actions

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€GitHub Actionsã‚’ä½¿ç”¨ã—ã¦ä»¥ä¸‹ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§è‡ªå‹•çš„ã«ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã™ï¼š

- **ãƒ—ãƒƒã‚·ãƒ¥æ™‚**: `main` ã¾ãŸã¯ `develop` ãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸæ™‚
- **ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚**: `main` ã¾ãŸã¯ `develop` ãƒ–ãƒ©ãƒ³ãƒã¸ã®PRä½œæˆæ™‚

#### å®Ÿè¡Œã•ã‚Œã‚‹ãƒ†ã‚¹ãƒˆ

1. **ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãƒ»çµ±åˆãƒ†ã‚¹ãƒˆãƒ»ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ**
   - Node.js 18.x ã¨ 20.x ã®ä¸¡æ–¹ã§å®Ÿè¡Œ
   - ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™

2. **ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆ**
   - ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå¾Œã€ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™
   - PRã«ã¯ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚µãƒãƒªãƒ¼ãŒã‚³ãƒ¡ãƒ³ãƒˆã•ã‚Œã¾ã™

3. **ãƒªãƒ³ã‚¿ãƒ¼**
   - ESLintã«ã‚ˆã‚‹ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯

#### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è¨­å®š

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«: `.github/workflows/test.yml`

```yaml
on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]
```

### ãƒ†ã‚¹ãƒˆçµæœã®ç¢ºèª

#### GitHub Actionsã§ã®ç¢ºèª

1. GitHubãƒªãƒã‚¸ãƒˆãƒªã®ã€ŒActionsã€ã‚¿ãƒ–ã‚’é–‹ã
2. å®Ÿè¡Œã•ã‚ŒãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’é¸æŠ
3. å„ã‚¸ãƒ§ãƒ–ã®ãƒ­ã‚°ã‚’ç¢ºèª

#### ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

1. GitHub Actionsã®å®Ÿè¡Œãƒšãƒ¼ã‚¸ã‚’é–‹ã
2. ã€ŒArtifactsã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰ `coverage-report` ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
3. è§£å‡ã—ã¦ `coverage/index.html` ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã

#### PRã¸ã®ã‚³ãƒ¡ãƒ³ãƒˆ

PRãŒä½œæˆã•ã‚Œã‚‹ã¨ã€è‡ªå‹•çš„ã«ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚µãƒãƒªãƒ¼ãŒã‚³ãƒ¡ãƒ³ãƒˆã•ã‚Œã¾ã™ï¼š

```
âœ… Coverage: 85.2%
ğŸ“Š Lines: 823/966
ğŸ“¦ Functions: 45/52
```

## ğŸ“Š ã‚«ãƒãƒ¬ãƒƒã‚¸è¨­å®š

### ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆå½¢å¼

ä»¥ä¸‹ã®å½¢å¼ã§ãƒ¬ãƒãƒ¼ãƒˆãŒç”Ÿæˆã•ã‚Œã¾ã™ï¼š

- **text**: ã‚¿ãƒ¼ãƒŸãƒŠãƒ«å‡ºåŠ›
- **json**: `coverage/coverage-final.json`
- **html**: `coverage/index.html`ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèªå¯èƒ½ï¼‰
- **lcov**: `coverage/lcov.info`ï¼ˆCI/CDã§ä½¿ç”¨ï¼‰

### é™¤å¤–è¨­å®š

ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ã‚«ãƒãƒ¬ãƒƒã‚¸ã‹ã‚‰é™¤å¤–ã•ã‚Œã¦ã„ã¾ã™ï¼š

- `node_modules/`
- `tests/`
- `**/*.test.ts`, `**/*.test.tsx`
- `**/*.spec.ts`, `**/*.spec.tsx`
- `**/__tests__/**`
- `**/.next/**`
- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`next.config.js`, `vitest.config.ts`ãªã©ï¼‰

è¨­å®šã¯ `vitest.config.ts` ã§ç®¡ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹å ´åˆ

1. **ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
   ```bash
   npm ci
   ```

2. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã‚¯ãƒªã‚¢**
   ```bash
   rm -rf node_modules/.vite
   npm test
   ```

3. **ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª**
   - ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚ã¯ç’°å¢ƒå¤‰æ•°ãŒä¸è¦ãªè¨­è¨ˆã«ãªã£ã¦ã„ã¾ã™ãŒã€å¿…è¦ã«å¿œã˜ã¦ `.env.test` ã‚’ä½œæˆã§ãã¾ã™

### ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆãŒç”Ÿæˆã•ã‚Œãªã„å ´åˆ

1. **ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ç¢ºèª**
   ```bash
   npm list @vitest/coverage-v8
   ```

2. **ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆæœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®å ´åˆï¼‰**
   ```bash
   npm install -D @vitest/coverage-v8
   ```

### CI/CDã§ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã™ã‚‹å ´åˆ

1. **ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®å†ç¾**
   ```bash
   npm ci
   npm test
   ```

2. **GitHub Actionsã®ãƒ­ã‚°ã‚’ç¢ºèª**
   - Actionsã‚¿ãƒ–ã§å¤±æ•—ã—ãŸã‚¸ãƒ§ãƒ–ã®ãƒ­ã‚°ã‚’ç¢ºèª
   - ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…ƒã«ä¿®æ­£

## ğŸ“ ãƒ†ã‚¹ãƒˆã®è¿½åŠ 

æ–°ã—ã„ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã™ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®è¦å‰‡ã«å¾“ã£ã¦ãã ã•ã„ï¼š

1. **ãƒ•ã‚¡ã‚¤ãƒ«å**: `*.test.ts` ã¾ãŸã¯ `*.test.tsx`ï¼ˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼‰
2. **é…ç½®å ´æ‰€**:
   - ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ: `tests/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
   - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
   - E2Eãƒ†ã‚¹ãƒˆ: `tests/e2e/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª

3. **ãƒ†ã‚¹ãƒˆæ§‹é€ **:
   ```typescript
   import { describe, it, expect } from 'vitest'
   
   describe('æ©Ÿèƒ½å', () => {
     it('ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®èª¬æ˜', () => {
       expect(actual).toBe(expected)
     })
   })
   ```

## ğŸ”— å‚è€ƒãƒªãƒ³ã‚¯

- [Vitestå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://vitest.dev/)
- [Testing Libraryå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://testing-library.com/)
- [Playwrightå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://playwright.dev/)
- [GitHub Actionså…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.github.com/en/actions)

---

**æœ€çµ‚æ›´æ–°**: 2025-01-XX  
**ä½œæˆç›®çš„**: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ–¹æ³•ã¨CI/CDè‡ªå‹•åŒ–ã®èª¬æ˜
